{"version":3,"sources":["galaxy.pages.js"],"names":["range","selectNodeContents","item_singular","selection","item_class","dialog_type","CONTROLS","ITEM_HISTORY","item_plural","item_controller","get_item_info","item_list_action","toLowerCase","plural","controller","iclass","list_ajax_url","ITEM_VISUALIZATION","make_item_importable","item_id","item_type","singular","replace","ajax_url","error","alert","$","document","ajaxError","e","x","message","responseText","statusText","show_modal","Ignore error","hide_modal","append","skin","basePath","editor_base_path","make_popupmenu","insert_link_menu_button","editor","WYMeditor","TOOLS","IFRAME","STATUS","name","title","css","embed_object_button","DIALOG_EMBED_DATASET","DIALOG_EMBED_WORKFLOW","DIALOG_EMBED_VISUALIZATION","wymeditors","save","callback","ajax","url","save_url","type","data","id","page_id","content","xhtml","annotations","JSON","stringify","Object","_","success","click","window","location","page_list_url","containers_menu","items","each","_options","containersItems","k","v","tagname","container","addClass","Insert History Link","dialog","DIALOG_HISTORY_LINK","Insert Dataset Link","DIALOG_DATASET_LINK","Insert Workflow Link","DIALOG_WORKFLOW_LINK","Insert Page Link","DIALOG_PAGE_LINK","Insert Visualization Link","DIALOG_VISUALIZATION_LINK","Embed History","DIALOG_EMBED_HISTORY","Embed Dataset","Embed Workflow","Embed Visualization","ITEM_DATASET","ITEM_WORKFLOW","ITEM_PAGE","dialogType","dialogFeatures","bodyHtml","wym","selected","attribute_input","val","attr","HREF","srcSelector","SRC","titleSelector","TITLE","remove","ALT","curURL","curTitle","undefined","altSelector","Make link","sUrl","hrefSelector","sId","_exec","CREATE_LINK","sStamp","body","link","text","indexOf","sName","Cancel","removeClass","this","dialogImageSelector","_selected_image","Insert","newRow","newCol","INSERT_IMAGE","sCaption","_doc","captionSelector","newCaption","table","createCaption","DIALOG_TABLE","item_info","TABLE","innerHTML","url_base","dict_format","insertRow","y","iCols","insertCell","buttons","summarySelector","make_importable","MAIN_CONTAINERS","get","node","parentNode","after","Galaxy","Close","grid","_gridView2","default","embedded","modal","show","$el","Array","getJSON","returned_item_info","link_text","insert","item_embed_html","hide","DIALOG_EMBED_PAGE","boxHtml","toolsItems","closing_events","Embed","changed","do_close","item_name","join"],"mappings":"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","file":"../scripts/galaxy.pages.js","sourcesContent":["import \"libs/jquery/jquery.form\";\nimport \"libs/jquery/jstorage\";\nimport \"libs/jquery/jquery.wymeditor\";\nimport \"libs/jquery/jquery.autocomplete\";\nimport GridView from \"mvc/grid/grid-view\";\n\nvar CONTROLS = {\n    // Item types.\n    ITEM_HISTORY: \"item_history\",\n    ITEM_DATASET: \"item_dataset\",\n    ITEM_WORKFLOW: \"item_workflow\",\n    ITEM_PAGE: \"item_page\",\n    ITEM_VISUALIZATION: \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK: \"link_history\",\n    DIALOG_DATASET_LINK: \"link_dataset\",\n    DIALOG_WORKFLOW_LINK: \"link_workflow\",\n    DIALOG_PAGE_LINK: \"link_page\",\n    DIALOG_VISUALIZATION_LINK: \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY: \"embed_history\",\n    DIALOG_EMBED_DATASET: \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW: \"embed_workflow\",\n    DIALOG_EMBED_PAGE: \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION: \"embed_visualization\"\n};\n\n// Initialize Galaxy elements.\nfunction init_galaxy_elts(wym) {\n    // Set up events to make annotation easy.\n    $(\".annotation\", wym._doc.body).each(function() {\n        $(this).click(function() {\n            // Works in Safari, not in Firefox.\n            var range = wym._doc.createRange();\n            range.selectNodeContents(this);\n            var selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            var t = \"\";\n        });\n    });\n}\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info(dialog_type) {\n    var item_singular;\n    var item_plural;\n    var item_controller;\n    var item_class;\n    switch (dialog_type) {\n        case CONTROLS.ITEM_HISTORY:\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case CONTROLS.ITEM_DATASET:\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case CONTROLS.ITEM_WORKFLOW:\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case CONTROLS.ITEM_PAGE:\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case CONTROLS.ITEM_VISUALIZATION:\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action = `list_${item_plural.toLowerCase()}_for_selection`;\n    var ajax_url = list_objects_url.replace(\"LIST_ACTION\", item_list_action);\n\n    // Set up and return dict.\n    return {\n        singular: item_singular,\n        plural: item_plural,\n        controller: item_controller,\n        iclass: item_class,\n        list_ajax_url: ajax_url\n    };\n}\n\n// Make an item importable.\nfunction make_item_importable(item_controller, item_id, item_type) {\n    var ajax_url = set_accessible_url.replace(\"ITEM_CONTROLLER\", item_controller);\n    $.ajax({\n        type: \"POST\",\n        url: ajax_url,\n        data: { id: item_id, accessible: \"True\" },\n        error: function() {\n            alert(`Making ${item_type} accessible failed`);\n        }\n    });\n}\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function(dialogType, dialogFeatures, bodyHtml) {\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id() {\n        // When \"set link id\" link clicked, update UI.\n        $(\"#set_link_id\").click(function() {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected) attribute_input.val($(selected).attr(\"id\"));\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if (dialogType == WYMeditor.DIALOG_LINK) {\n        if (selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val($(selected).attr(WYMeditor.TITLE));\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n\n        // Get current URL, title.\n        var curURL;\n\n        var curTitle;\n        if (selected) {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined) curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined) curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            `<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='${\n                curURL\n            }' size='40' /></div><div><label>Title</label><br><input type='text' class='wym_title' value='${\n                curTitle\n            }' size='40' /></div><div>`,\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || \"\";\n\n                    var sId = $(\".wym_id\").val() || \"\";\n                    var sName = $(wym._options.titleSelector).val() || \"\";\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(`a[href=${sStamp}]`, wym._doc.body);\n                        link\n                            .attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf(\"wym-\") === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if (dialogType == WYMeditor.DIALOG_IMAGE) {\n        if (wym._selected_image) {\n            $(`${wym._options.dialogImageSelector} ${wym._options.srcSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.SRC)\n            );\n            $(`${wym._options.dialogImageSelector} ${wym._options.titleSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.TITLE)\n            );\n            $(`${wym._options.dialogImageSelector} ${wym._options.altSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.ALT)\n            );\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\" +\n                \"<label>URL</label><br>\" +\n                \"<input type='text' class='wym_src' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Alt text</label><br>\" +\n                \"<input type='text' class='wym_alt' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Title</label><br>\" +\n                \"<input type='text' class='wym_title' value='' size='40' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if (sUrl.length > 0) {\n                        wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                        $(`img[src$=${sStamp}]`, wym._doc.body)\n                            .attr(WYMeditor.SRC, sUrl)\n                            .attr(WYMeditor.TITLE, $(wym._options.titleSelector).val())\n                            .attr(WYMeditor.ALT, $(wym._options.altSelector).val());\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if (dialogType == WYMeditor.DIALOG_TABLE) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\" +\n                \"<label>Caption</label><br>\" +\n                \"<input type='text' class='wym_caption' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Summary</label><br>\" +\n                \"<input type='text' class='wym_summary' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Rows<br></label>\" +\n                \"<input type='text' class='wym_rows' value='3' size='3' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Cols<br></label>\" +\n                \"<input type='text' class='wym_cols' value='2' size='3' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if (iRows > 0 && iCols > 0) {\n                        var table = wym._doc.createElement(WYMeditor.TABLE);\n                        var newRow = null;\n                        var newCol = null;\n\n                        var sCaption = $(wym._options.captionSelector).val();\n\n                        //we create the caption\n                        var newCaption = table.createCaption();\n                        newCaption.innerHTML = sCaption;\n\n                        //we create the rows and cells\n                        for (var x = 0; x < iRows; x++) {\n                            newRow = table.insertRow(x);\n                            for (var y = 0; y < iCols; y++) {\n                                newRow.insertCell(y);\n                            }\n                        }\n\n                        //set the summary attr\n                        $(table).attr(\"summary\", $(wym._options.summarySelector).val());\n\n                        //append the table after the selected container\n                        var node = $(wym.findUp(wym.container(), WYMeditor.MAIN_CONTAINERS)).get(0);\n                        if (!node || !node.parentNode) $(wym._doc.body).append(table);\n                        else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if (\n        dialogType == CONTROLS.DIALOG_HISTORY_LINK ||\n        dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n        dialogType == CONTROLS.DIALOG_WORKFLOW_LINK ||\n        dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n        dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_HISTORY_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_DATASET_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_WORKFLOW_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_PAGE_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_VISUALIZATION_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        var grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            dict_format: true,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: `Insert Link to ${item_info.singular}`,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                        .append(\n                            `Make the selected ${item_info.plural.toLowerCase()} accessible so that they can viewed by everyone.`\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Insert: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                    // Insert links to history for each checked item.\n                    var item_ids = new Array();\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        var item_id = $(this).val();\n\n                        // Make item importable?\n                        if (make_importable) make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                        // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                        var url_template = get_name_and_link_url + item_id;\n                        var ajax_url = url_template.replace(\"ITEM_CONTROLLER\", item_info.controller);\n                        $.getJSON(ajax_url, returned_item_info => {\n                            // Get link text.\n                            wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                            var link_text = $(`a[href=${sStamp}]`, wym._doc.body).text();\n\n                            // Insert link: need to do different actions depending on link text.\n                            if (\n                                link_text == \"\" || // Firefox.\n                                link_text == sStamp // Safari\n                            ) {\n                                // User selected no text; create link from scratch and use default text.\n                                wym.insert(\n                                    `<a href='${returned_item_info.link}'>${item_info.singular} '${\n                                        returned_item_info.name\n                                    }'</a>`\n                                );\n                            } else {\n                                // Link created from selected text; add href and title.\n                                $(`a[href=${sStamp}]`, wym._doc.body)\n                                    .attr(WYMeditor.HREF, returned_item_info.link)\n                                    .attr(WYMeditor.TITLE, item_info.singular + item_id);\n                            }\n                        });\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if (\n        dialogType == CONTROLS.DIALOG_EMBED_HISTORY ||\n        dialogType == CONTROLS.DIALOG_EMBED_DATASET ||\n        dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW ||\n        dialogType == CONTROLS.DIALOG_EMBED_PAGE ||\n        dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_EMBED_HISTORY:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_EMBED_DATASET:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_EMBED_WORKFLOW:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_EMBED_PAGE:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_EMBED_VISUALIZATION:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        var grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            dict_format: true,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: `Insert Link to ${item_info.singular}`,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                        .append(\n                            `Make the selected ${item_info.plural.toLowerCase()} accessible so that they can viewed by everyone.`\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Embed: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        // Get item ID and name.\n                        var item_id = $(this).val();\n                        // Use ':first' because there are many labels in table; the first one is the item name.\n                        var item_name = $(`label[for='${item_id}']:first`).text();\n\n                        if (make_importable) make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                        // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                        // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                        // item_class='History').\n                        var item_elt_id = `${item_info.iclass}-${item_id}`;\n                        var item_embed_html = [\n                            \"<div id='\",\n                            item_elt_id,\n                            \"' class='embedded-item \",\n                            item_info.singular.toLowerCase(),\n                            \" placeholder'>\",\n                            \"<p class='title'>\",\n                            \"Embedded Galaxy \",\n                            item_info.singular,\n                            \" '\",\n                            item_name,\n                            \"'\",\n                            \"</p>\",\n                            \"<p class='content'>\",\n                            \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                            item_info.singular.toLowerCase(),\n                            \" when it is displayed.]\",\n                            \"</p>\",\n                            \"</div>\"\n                        ].join(\"\");\n\n                        // Insert embedded item into document.\n                        wym.insert(item_embed_html);\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n};\n\nexport default function editor_onload() {\n    // Generic error handling\n    $(document).ajaxError((e, x) => {\n        // console.log( e, x );\n        var message = x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal(\"Server error\", message, { \"Ignore error\": hide_modal });\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor({\n        skin: \"galaxy\",\n        basePath: editor_base_path,\n        iframeBasePath: iframe_base_path,\n        // + WYMeditor.HTML\n        boxHtml: `<table class='wym_box' width='100%' height='100%'><tr><td><div class='wym_area_top'>${\n            WYMeditor.TOOLS\n        }</div></td></tr><tr height='100%'><td><div class='wym_area_main' style='height: 100%;'>${\n            // + WYMeditor.HTML\n            WYMeditor.IFRAME\n        }${WYMeditor.STATUS}</div></div></td></tr></table>`,\n        toolsItems: [\n            { name: \"Bold\", title: \"Strong\", css: \"wym_tools_strong\" },\n            { name: \"Italic\", title: \"Emphasis\", css: \"wym_tools_emphasis\" },\n            {\n                name: \"Superscript\",\n                title: \"Superscript\",\n                css: \"wym_tools_superscript\"\n            },\n            {\n                name: \"Subscript\",\n                title: \"Subscript\",\n                css: \"wym_tools_subscript\"\n            },\n            {\n                name: \"InsertOrderedList\",\n                title: \"Ordered_List\",\n                css: \"wym_tools_ordered_list\"\n            },\n            {\n                name: \"InsertUnorderedList\",\n                title: \"Unordered_List\",\n                css: \"wym_tools_unordered_list\"\n            },\n            { name: \"Indent\", title: \"Indent\", css: \"wym_tools_indent\" },\n            { name: \"Outdent\", title: \"Outdent\", css: \"wym_tools_outdent\" },\n            { name: \"Undo\", title: \"Undo\", css: \"wym_tools_undo\" },\n            { name: \"Redo\", title: \"Redo\", css: \"wym_tools_redo\" },\n            { name: \"CreateLink\", title: \"Link\", css: \"wym_tools_link\" },\n            { name: \"Unlink\", title: \"Unlink\", css: \"wym_tools_unlink\" },\n            { name: \"InsertImage\", title: \"Image\", css: \"wym_tools_image\" },\n            { name: \"InsertTable\", title: \"Table\", css: \"wym_tools_table\" }\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = callback => {\n        show_modal(\"Saving page\", \"progress\");\n\n        // Do save.\n        $.ajax({\n            url: save_url,\n            type: \"POST\",\n            data: {\n                id: page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify(new Object()),\n                // annotations: JSON.stringify(annotations),\n                _: \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    };\n    // Save button\n    $(\"#save-button\").click(() => {\n        save(() => {\n            hide_modal();\n        });\n    });\n    // Close button\n    $(\"#close-button\").click(() => {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if (changed) {\n            var do_close = () => {\n                window.onbeforeunload = undefined;\n                window.document.location = page_list_url;\n            };\n            show_modal(\n                \"Close editor\",\n                \"There are unsaved changes to your page which will be lost.\",\n                {\n                    Cancel: hide_modal,\n                    \"Save Changes\": function() {\n                        save(do_close);\n                    }\n                },\n                {\n                    \"Don't Save\": do_close\n                }\n            );\n        } else {\n            window.document.location = page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\n        \"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\"\n    );\n    $(\".wym_area_top\").append(containers_menu);\n\n    // Add menu options.\n    var items = {};\n    $.each(editor._options.containersItems, (k, v) => {\n        var tagname = v.name;\n        items[v.title.replace(\"_\", \" \")] = () => {\n            editor.container(tagname);\n        };\n    });\n    make_popupmenu(containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\n        \"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu(insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        }\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\n        \"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu(embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        }\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n}\n"]}